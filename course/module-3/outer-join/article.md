---
meta:
  title: "Внешнее соединение OUTER JOIN"
  description: "Описание и синтаксис внешнего соединения OUTER JOIN"
---

# Внешнее соединение OUTER JOIN

Внешнее соединение может быть трёх типов: левое (`LEFT`), правое (`RIGHT`) и полное (`FULL`). По умолчанию оно является полным.

Главным отличием внешнего соединения от внутреннего является то, что оно обязательно возвращает все строки одной (`LEFT`, `RIGHT`) или двух таблиц (`FULL`).

## Внешнее левое соединение (LEFT OUTER JOIN)

Соединение, которое возвращает все значения из левой таблицы, соединённые с соответствующими значениями из правой таблицы,
если они удовлетворяют условию соединения, или заменяет их на `NULL` в обратном случае.

Для примера получим из базы данных расписание звонков, объединённых с соответствующими занятиями в расписании занятий.

<ERD databaseName="Schedule" />

Данные в таблице `Timepair` (расписание звонков):

Данные в таблице `Schedule` (расписание занятий):

```sql-executable-Schedule
SELECT Timepair.id 'timepair.id', start_pair, end_pair,
    Schedule.id 'schedule.id', date, class, number_pair, teacher, subject, classroom
FROM Timepair
    LEFT JOIN Schedule ON Schedule.number_pair = Timepair.id;
```

В выборку попали все строки из левой таблицы, дополненные данными о занятиях.
Примечательно, что в конце таблицы есть строки с полями, заполненными `NULL`.
Это те строки, для которых не нашлось соответствующих занятий, однако они присутствуют в левой таблице, поэтому тоже были выведены.

## Внешнее правое соединение (RIGHT OUTER JOIN)

Соединение, которое возвращает все значения из правой таблицы, соединённые с соответствующими значениями из левой таблицы, если они удовлетворяют условию соединения,
или заменяет их на `NULL` в обратном случае.

<PostgreSQLOnly>

## Внешнее полное соединение (FULL OUTER JOIN)

Соединение, которое выполняет внутреннее соединение записей и дополняет их левым внешним соединением и правым внешним соединением.

Алгоритм работы полного соединения:

- Формируется таблица на основе внутреннего соединения (`INNER JOIN`)
- В таблицу добавляются значения, не вошедшие в результат формирования из левой таблицы (`LEFT OUTER JOIN`)
- В таблицу добавляются значения, не вошедшие в результат формирования из правой таблицы (`RIGHT OUTER JOIN`)

</PostgreSQLOnly>

<MySQLOnly>

## Эмуляция полного соединения в MySQL

Поскольку MySQL не поддерживает `FULL OUTER JOIN`, его можно эмулировать с помощью `UNION ALL`:

```sql
SELECT *
FROM левая_таблица
LEFT JOIN правая_таблица
   ON правая_таблица.ключ = левая_таблица.ключ

UNION ALL

SELECT *
FROM левая_таблица
RIGHT JOIN правая_таблица
ON правая_таблица.ключ = левая_таблица.ключ
 WHERE левая_таблица.ключ IS NULL
```

</MySQLOnly>

## Базовые запросы для разных вариантов объединения таблиц

<Table>
    <thead>
        <tr>
            <th>Схема</th>
            <th>Запрос с JOIN</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>
                <img src="/static/guidePage/multi-table-request-join/left.svg" width="100" />
            </td>
            <td>
                Получение всех данных из левой таблицы, соединённых с соответствующими
                данными из правой: 
                ```sql 
                SELECT поля_таблиц 
                FROM левая_таблица LEFT JOIN правая_таблица 
                    ON правая_таблица.ключ = левая_таблица.ключ 
                ```
            </td>
        </tr>
        <tr>
            <td>
                <img src="/static/guidePage/multi-table-request-join/right.svg" />
            </td>
            <td>
                Получение всех данных из правой таблицы, соединённых с соответствующими
                данными из левой:
                ```sql 
                SELECT поля_таблиц
                FROM левая_таблица RIGHT JOIN правая_таблица
                    ON правая_таблица.ключ = левая_таблица.ключ
                ```
            </td>
        </tr>
        <tr>
            <td>
                <img src="/static/guidePage/multi-table-request-join/left_no_right.svg" />
            </td>
            <td>
                Получение данных, относящихся только к левой таблице:
                ```sql 
                SELECT поля_таблиц
                FROM левая_таблица LEFT JOIN правая_таблица
                    ON правая_таблица.ключ = левая_таблица.ключ
                WHERE правая_таблица.ключ IS NULL
                ```
            </td>
        </tr>
        <tr>
            <td>
                <img src="/static/guidePage/multi-table-request-join/right_no_left.svg" />
            </td>
            <td>
                Получение данных, относящихся только к правой таблице:
                ```sql 
                SELECT поля_таблиц
                FROM левая_таблица RIGHT JOIN правая_таблица
                    ON правая_таблица.ключ = левая_таблица.ключ
                WHERE левая_таблица.ключ IS NULL
                ```
            </td>
        </tr>
        <tr>
            <td>
                <img src="/static/guidePage/multi-table-request-join/right_and_left.svg" />
            </td>
            <td>
                Получение данных, относящихся как к левой, так и к правой таблице:
                ```sql 
                SELECT поля_таблиц
                FROM левая_таблица INNER JOIN правая_таблица
                    ON правая_таблица.ключ = левая_таблица.ключ
                ```
            </td>
        </tr>
        <tr>
            <td>
                <img src="/static/guidePage/multi-table-request-join/all.svg" />
            </td>
            <td>
                Получение всех данных, относящихся к левой и правой таблицам, а также их
                внутреннему соединению:

<PostgreSQLOnly>

```sql
SELECT поля_таблиц
FROM левая_таблица
    FULL OUTER JOIN правая_таблица
    ON правая_таблица.ключ = левая_таблица.ключ
```

</PostgreSQLOnly>

<MySQLOnly>

```sql
SELECT поля_таблиц
FROM левая_таблица
LEFT JOIN правая_таблица
    ON правая_таблица.ключ = левая_таблица.ключ

UNION ALL

SELECT поля_таблиц
FROM левая_таблица
RIGHT JOIN правая_таблица
    ON правая_таблица.ключ = левая_таблица.ключ
WHERE левая_таблица.ключ IS NULL
```

</MySQLOnly>

            </td>
        </tr>
                <tr>
            <td>
                <img src="/static/guidePage/multi-table-request-join/right_xor_left.svg" />
            </td>
            <td>
                Получение данных, не относящихся к левой и правой таблицам одновременно
                (обратное INNER JOIN):

<PostgreSQLOnly>

```sql
SELECT поля_таблиц
FROM левая_таблица
    FULL OUTER JOIN правая_таблица
    ON правая_таблица.ключ = левая_таблица.ключ
WHERE левая_таблица.ключ IS NULL
    OR правая_таблица.ключ IS NULL
```

</PostgreSQLOnly>

<MySQLOnly>

```sql
SELECT поля_таблиц
FROM левая_таблица
LEFT JOIN правая_таблица
    ON правая_таблица.ключ = левая_таблица.ключ
WHERE правая_таблица.ключ IS NULL

UNION ALL

SELECT поля_таблиц
FROM левая_таблица
RIGHT JOIN правая_таблица
    ON правая_таблица.ключ = левая_таблица.ключ
WHERE левая_таблица.ключ IS NULL
```

</MySQLOnly>

            </td>
        </tr>
    </tbody>

</Table>
