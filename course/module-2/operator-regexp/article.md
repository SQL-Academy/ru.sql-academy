---
meta:
  title: "Операторы REGEXP и ~ в SQL"
  description: "Использование регулярных выражений в SQL с помощью операторов REGEXP в MySQL и ~ в PostgreSQL"
---

<MySQLOnly>
# Оператор REGEXP для регулярных выражений

Оператор `REGEXP` (или его синоним `RLIKE`) в MySQL используется для поиска и обработки строковых данных
с помощью регулярных выражений.

</MySQLOnly>

<PostgreSQLOnly>

# Оператор регулярных выражений ~

Операторы `~` и `~*` в PostgreSQL используются для поиска и обработки строковых данных
с помощью регулярных выражений.

</PostgreSQLOnly>

Регулярные выражения предоставляют мощные возможности для сложных шаблонов поиска,
которые трудно реализовать с помощью оператора `LIKE`.

## Когда использовать регулярные выражения вместо LIKE?

Оператор `LIKE` удобен для простых шаблонов поиска, таких как поиск строк,
начинающихся или заканчивающихся на определённый набор символов, или содержащих определённые подстроки.
Однако, если требуется более сложный и гибкий поиск, например, поиск по нескольким условиям или
использование специальных символов и диапазонов, операторы регулярных выражений станут незаменимым инструментом.

## Синтаксис регулярных выражений

<MySQLOnly>

```sql
... WHERE table_field REGEXP 'pattern';
```

Где `pattern` — это регулярное выражение, задающее шаблон поиска.

</MySQLOnly>

<PostgreSQLOnly>

```sql
... WHERE table_field ~ 'pattern';   -- с учетом регистра
... WHERE table_field ~* 'pattern';  -- без учета регистра
```

Где `pattern` — это регулярное выражение, задающее шаблон поиска.

</PostgreSQLOnly>

## Важные нюансы

<MySQLOnly>

1. **Регистронезависимость**

   По умолчанию регулярные выражения в MySQL не чувствительны к регистру.
   Например, выражение `REGEXP 'abc'` найдёт строку и `abc`, и `Abc`, и `ABC`.

2. **Специальные символы**

   Некоторые символы имеют особое значение в регулярных выражениях и требуют экранирования
   (например, `.`, `*`, `+`, `?`, `[`, `]`, `(`, `)`, `{`, `}`, `|`, `\`).

   Для экранирования таких символов используйте двойной обратный слеш — `\\`.

</MySQLOnly>

<PostgreSQLOnly>

1. **Регистрозависимость**

   По умолчанию регулярные выражения в PostgreSQL чувствительны к регистру.

   - Оператор `~` — с учетом регистра
   - Оператор `~*` — без учета регистра

2. **Специальные символы**

   Некоторые символы имеют особое значение в регулярных выражениях и требуют экранирования
   (например, `.`, `*`, `+`, `?`, `[`, `]`, `(`, `)`, `{`, `}`, `|`, `\`).

   Для экранирования таких символов используйте одинарный обратный слеш — `\`.

</PostgreSQLOnly>

## Специальные символы и структуры

| Символы и структуры | Чему соответствует                                                                      |
| :------------------ | :-------------------------------------------------------------------------------------- |
| `*`                 | 0 или более экземпляров предшествующей строки                                           |
| `+`                 | 1 или более экземпляров предшествующих строк                                            |
| `.`                 | Любой одиночный символ                                                                  |
| `?`                 | 0 или 1 экземпляр предшествующей строки                                                 |
| `^`                 | Соответствует началу строки                                                             |
| `$`                 | Соответствует окончанию строки                                                          |
| `[abc]`             | Любой символ, указанный в квадратных скобках                                            |
| `[^abc]`            | Любой символ, не указанный в квадратных скобках                                         |
| `[A-Z]`, `[А-Я]`    | Соответствует любой заглавной букве латинского и кириллического алфавита соответственно |
| `[a-z]`, `[а-я]`    | Соответствует любой строчной букве латинского и кириллического алфавита соответственно  |
| `[0-9]`             | Соответствует любой цифре                                                               |
| `p1\|p2\|p3`        | Соответствует любому из паттернов `p1` или `p2` или `p3`                                |
| `{n}`               | `n` экземпляров предыдущей строки                                                       |
| `{m,n}`             | от `m` до `n` экземпляров предыдущей строки                                             |

## Примеры с объяснением

- **Получим всех пользователей, чьи имена начинаются на «John»:**

  <MySQLOnly>

  ```sql-executable-Airbnb
  SELECT * FROM Users WHERE name REGEXP '^John'
  ```

  </MySQLOnly>

  <PostgreSQLOnly>

  ```sql-executable-Airbnb
  SELECT * FROM Users WHERE name ~ '^John'
  ```

  </PostgreSQLOnly>

  Это выражение ищет строки, начинающиеся с «John». Символ `^` указывает на начало строки.

- **Выведем все школьные предметы, название которых оканчивается на букву «e» или «y»:**

  <MySQLOnly>

  ```sql-executable-Schedule
  SELECT * FROM  Subject WHERE name REGEXP '[ey]$'
  ```

  </MySQLOnly>

  <PostgreSQLOnly>

  ```sql-executable-Schedule
  SELECT * FROM  Subject WHERE name ~ '[ey]$'
  ```

  </PostgreSQLOnly>

  В этом примере, `[ey]` определяет список возможных значений для паттерна `$`, определяющего, на что должна заканчиваться строка.

- **Найдём всех пользователей, чей адрес электронной почты oканчивается на «@outlook.com» или на «@icloud.com»:**

  <MySQLOnly>

  ```sql-executable-Airbnb
  SELECT * FROM Users WHERE email REGEXP '@(outlook.com|icloud.com)$'
  ```

  </MySQLOnly>

  <PostgreSQLOnly>

  ```sql-executable-Airbnb
  SELECT * FROM Users WHERE email ~ '@(outlook\.com|icloud\.com)$'
  ```

  </PostgreSQLOnly>

  Здесь также используется `$` для обозначения конца строки и `|` для указания нескольких вариантов.

- **Найдём всех пользователей, чей номер телефона не содержит цифр «2» и «8»:**

  <MySQLOnly>

  ```sql-executable-Airbnb
  SELECT * FROM Users WHERE phone_number REGEXP '^[^28]*$'
  ```

  </MySQLOnly>

  <PostgreSQLOnly>

  ```sql-executable-Airbnb
  SELECT * FROM Users WHERE phone_number ~ '^[^28]*$'
  ```

  </PostgreSQLOnly>

  В этом примере символ `[^28]` обозначает любой символ, кроме «2» и «8», а
  `*` означает любое количество таких символов. Символы `^` и `$` указывают на начало и конец строки
  соответственно, гарантируя, что вся строка соответствует шаблону.

- **Найдём всех пользователей, чей номер телефона начинается на «+7»**

  <MySQLOnly>

  ```sql-executable-Airbnb
  SELECT name, phone_number FROM Users WHERE phone_number REGEXP '^\\+7'
  ```

  </MySQLOnly>

  <PostgreSQLOnly>

  ```sql-executable-Airbnb
  SELECT name, phone_number FROM Users WHERE phone_number ~ '^\+7'
  ```

  </PostgreSQLOnly>

  В этом примере `^` означает начало строки. То есть, мы ищем строки, которые начинаются с определённого шаблона.

  <MySQLOnly>

  Поскольку `+` является специальным символом в регулярных выражениях, его нужно экранировать двойным обратным слэшем (`\\`),
  чтобы он воспринимался как обычный символ `+`. В результате, `\\+` соответствует знаку `+` в строке.

  </MySQLOnly>

  <PostgreSQLOnly>

  Поскольку `+` является специальным символом в регулярных выражениях, его нужно экранировать одинарным обратным слэшем (`\`),
  чтобы он воспринимался как обычный символ `+`. В результате, `\+` соответствует знаку `+` в строке.

  </PostgreSQLOnly>
